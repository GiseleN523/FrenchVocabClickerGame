<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>French Vocab Practice</title>
        <script src="p5.min.js"></script>
        <style>
            body {
                text-align: center;
            }
            button {
                background-color: #ebd08d;
                color: black;
                font-size: 200%;
                padding: 1em;
                border-radius: 1em;
            }
            button:hover {
                background-color: black;
                color: #ebd08d;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <script>
            let roomImage;
            let score; // total score
            let scorePossible; // the remaining points possible for this question; decreases each time the player makes a wrong guess
            let currentZone; // zone (word/question) being asked about this turn
            let buttonsVisible;
            let buttonFem;
            let buttonMasc;
            let showFeedbackRect = null; // function that shows "feedback rectangle" (green or red rectangle visible to player after they make a guess)
            let showFeedbackRectUntil = Date.now(); // feedback rectangle is visible until this time

            let zones = [
                {word: "Peinture", feminine: true, x1: 687, y1:210, x2: 830, y2: 345},
                {word: "Chaise", feminine: true, x1: 0, y1:430, x2: 155, y2: 675},
                {word: "Sac à dos", feminine: false, x1: 270, y1:870, x2: 374, y2: 975},
                {word: "Lit", feminine: false, x1: 325, y1:390, x2: 577, y2: 716},
                {word: "Porte", feminine: true, x1: 160, y1:215, x2: 315, y2: 567},
                {word: "Fenêtre", feminine: true, x1: 453, y1:145, x2: 670, y2: 370},
                {word: "Ordinateur", feminine: false, x1: 717, y1:361, x2: 803, y2: 450},
                {word: "Lampe", feminine: true, x1: 577, y1:391, x2: 635, y2: 485},
                {word: "Table", feminine: true, x1: 652, y1:450, x2: 847, y2: 590},
                {word: "Lunettes", feminine: true, x1: 147, y1:150, x2: 235, y2: 185},
                {word: "Plante", feminine: true, x1: 944, y1:434, x2: 1000, y2: 562},
                {word: "Livre", feminine: false, x1: 363, y1:755, x2: 487, y2: 870},
                {word: "Crayon", feminine: false, x1: 502, y1:831, x2: 566, y2: 975},
                {word: "Chaussures", feminine: true, x1: 150, y1:909, x2: 250, y2: 980},
                {word: "Ours en Peluche", feminine: false, x1: 110, y1:678, x2: 221, y2: 815},
                {word: "Peigne", feminine: false, x1: 685, y1:839, x2: 720, y2: 975},
                {word: "Mappemonde", feminine: true, x1: 720, y1:655, x2: 827, y2: 780},
                {word: "Clavier", feminine: false, x1: 711, y1:782, x2: 819, y2: 835},
                {word: "Poubelle", feminine: true, x1: 880, y1:815, x2: 980, y2: 985},
                {word: "Tabouret", feminine: false, x1: 720, y1:857, x2: 863, y2: 985},
            ];

            function preload() {
                roomImage = loadImage("bedroom.png");
            }

            function setup() {
                createCanvas(1000, 1000);
                textAlign(CENTER, CENTER);
                background(0);
                score = 0;
                buttonFem = createButton('Feminine');
                buttonMasc = createButton('Masculine');
                buttonFem.mousePressed(femPressed);
                buttonMasc.mousePressed(mascPressed);
                nextTurn();
            }

            function draw() {
                image(roomImage, 0, 0);
                cursor('default');
                checkMouseover();
                fill('white');
                rect(-2, 15, windowWidth, 60);
                fill('black');
                textSize(30);
                textAlign(CENTER, CENTER);
                text("Find this object: " + currentZone.word, 500, 50);
                text("Score: " + score, 920, 50);
                //text("(" + int(mouseX) + ", " + int(mouseY) +")", mouseX, mouseY); // display cursor coordinates

                buttonsVisible ? buttonFem.position(500, 500) : buttonFem.position(500, -150);
                buttonsVisible ? buttonMasc.position(800, 500) : buttonMasc.position(800, -150);
                
                if(buttonsVisible || showFeedbackRectUntil > Date.now()) {
                    showFeedbackRect();
                }
                if(zones.length < 1) { // game over
                    fill('#ebd08d');
                    rect(300, 400, 400, 200);
                    stroke('black');
                    fill('black');
                    text("Game Over!", 500, 475);
                    text("Final Score: " + score + "/120", 500, 525);
                }
            }

            function checkMouseover() {
                if(!buttonsVisible && showFeedbackRectUntil <= Date.now() && zones.length > 0) {
                    zones.forEach(function(zone) {
                        if(mouseX > zone.x1 && mouseX < zone.x2 && mouseY > zone.y1 && mouseY < zone.y2) {
                            cursor('pointer');
                            fill(255, 255, 0, 100);
                            rect(zone.x1, zone.y1, zone.x2-zone.x1, zone.y2-zone.y1);
                            return;
                        }
                    });
                }
            }

            function mousePressed() {
                if(!buttonsVisible && showFeedbackRectUntil <= Date.now() && zones.length > 0) {
                    zones.forEach(function(zone) {
                        if(mouseX > zone.x1 && mouseX < zone.x2 && mouseY > zone.y1 && mouseY < zone.y2) {
                            if(zone === currentZone) {
                                text("Correct!", mouseX, mouseY);
                                showFeedbackRect = function() {fill(0, 255, 0, 100); rect(zone.x1, zone.y1, zone.x2-zone.x1, zone.y2-zone.y1)};
                                buttonsVisible = true;
                                score += scorePossible;
                                scorePossible = 1;
                            }
                            else {
                                text("Incorrect...", mouseX, mouseY);
                                showFeedbackRect = function() {fill(255, 0, 0, 100); rect(zone.x1, zone.y1, zone.x2-zone.x1, zone.y2-zone.y1)};
                                showFeedbackRectUntil = Date.now() + 750;
                                scorePossible > 1 ? scorePossible -= 1 : scorePossible = 0;
                            }
                            return;
                        }
                    });
                }
            }

            function nextTurn() {
                scorePossible = 5;
                zones.splice(zones.indexOf(currentZone), 1);
                if(zones.length > 0) {
                    currentZone = zones[int(Math.random()*zones.length)];
                }
            }

            function femPressed(e) {
                e.stopPropagation(); // prevent elements behind button from getting triggered
                if(currentZone.feminine) {
                    score += scorePossible;
                    buttonsVisible = false;
                    nextTurn();
                }
                else {
                    scorePossible = 0;
                }
            }

            function mascPressed(e) {
                e.stopPropagation(); // prevent elements behind button from getting triggered
                if(!currentZone.feminine) {
                    score += scorePossible;
                    buttonsVisible = false;
                    nextTurn();
                }
                else {
                    scorePossible = 0;
                }
            }

        </script>
    </body>
</html>
